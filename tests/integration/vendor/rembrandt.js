!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Rembrandt=t():e.Rembrandt=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){(function(t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(1),u=(i(o),n(2)),s=i(u),c=n(3),f=i(c),l=n(4),h=i(l),d=n(5),m=i(d),p=n(6),g=i(p),v=n(7),_=i(v);t.Buffer=function(){};var y=function(){function e(t){r(this,e),this._imageA=null,this._imageB=null,this._options=s.default.defaults(t,{imageA:null,imageB:null,thresholdType:e.THRESHOLD_PERCENT,maxThreshold:.01,maxDelta:.02,renderComposition:!1,compositionMaskColor:g.default.RED,maxOffset:0}),this._validateOptions()}return a(e,[{key:"compare",value:function(){var e=this;return this._loadImages().then(function(){var t=new _.default(e._imageA,e._imageB,e._options);return t.compare()})}},{key:"_validateOptions",value:function(){var t=this,n=function(e){var n=t._options[e];if(!("string"==typeof n||Buffer.isBuffer(n)||n instanceof m.default))throw new Error("Option `"+e+"` must either be a String, Buffer or Rembrandt.Image.")};n("imageA"),n("imageB");var i=this._options,r=i.thresholdType,a=i.threshold,o=[e.THRESHOLD_PERCENT,e.THRESHOLD_PIXELS];if(o.indexOf(r)===-1)throw new Error("`thresholdType` must be either Rembrandt.THRESHOLD_PERCENT or Rembrandt.THRESHOLD_PIXELS");if(r===e.THRESHOLD_PERCENT&&(a<0||a>1))throw new Error("`threshold` must be between 0 and 1")}},{key:"_loadImages",value:function(){var e=this;return this._loadImage(this._options.imageA).then(function(t){return e._imageA=t,e._loadImage(e._options.imageB)}).then(function(t){e._imageB=t})}},{key:"_loadImage",value:function(e){return new f.default(function(t,n){if(e instanceof m.default)return t(e);if(e instanceof Buffer)return t(m.default.fromBuffer(e));var i=s.default.createImage();i.addEventListener("load",function(){t(m.default.fromImage(i))}),i.crossOrigin="Anonymous",i.src=e})}}],[{key:"createImage",value:function(e,t){return new m.default(e,t)}}]),e}();y.Image=m.default,y.Color=g.default,y.version=n(9).version;for(var b in h.default)y[b]=h.default[b];e.exports=y}).call(t,function(){return this}())},function(e,t){"use strict"},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){i(this,e)}return r(e,null,[{key:"defaults",value:function(e){var t={};for(var n in e)t[n]=e[n];for(var i=arguments.length,r=Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];for(var o=0;o<r.length;o++){var u=r[o];for(var s in u)"undefined"==typeof t[s]&&(t[s]=u[s])}return t}},{key:"createCanvas",value:function(e,t){var n=void 0;return n=document.createElement("canvas"),n.width=e,n.height=t,n}},{key:"createImage",value:function(){var e=void 0;return e=new window.Image}}]),e}();t.default=a},function(e,t,n){var i;(function(r){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};/*!
	 * Native Promise Only
	 * v0.8.0-a (c) Kyle Simpson
	 * MIT License: http://getify.mit-license.org
	 * @license
	 */
!function(r,a,o){a[r]=a[r]||o(),"undefined"!=typeof e&&e.exports?e.exports=a[r]:(i=function(){return a[r]}.call(t,n,t,e),!(void 0!==i&&(e.exports=i)))}("Promise","undefined"!=typeof r?r:void 0,function(){function e(e,t){d.add(e,t),h||(h=p(d.drain))}function t(e){var t,n="undefined"==typeof e?"undefined":a(e);return null==e||"object"!=n&&"function"!=n||(t=e.then),"function"==typeof t&&t}function n(){for(var e=0;e<this.chain.length;e++)i(this,1===this.state?this.chain[e].success:this.chain[e].failure,this.chain[e]);this.chain.length=0}function i(e,n,i){var r,a;try{n===!1?i.reject(e.msg):(r=n===!0?e.msg:n.call(void 0,e.msg),r===i.promise?i.reject(TypeError("Promise-chain cycle")):(a=t(r))?a.call(r,i.resolve,i.reject):i.resolve(r))}catch(e){i.reject(e)}}function r(i){var a,u=this;if(!u.triggered){u.triggered=!0,u.def&&(u=u.def);try{(a=t(i))?e(function(){var e=new s(u);try{a.call(i,function(){r.apply(e,arguments)},function(){o.apply(e,arguments)})}catch(t){o.call(e,t)}}):(u.msg=i,u.state=1,u.chain.length>0&&e(n,u))}catch(e){o.call(new s(u),e)}}}function o(t){var i=this;i.triggered||(i.triggered=!0,i.def&&(i=i.def),i.msg=t,i.state=2,i.chain.length>0&&e(n,i))}function u(e,t,n,i){for(var r=0;r<t.length;r++)!function(r){e.resolve(t[r]).then(function(e){n(r,e)},i)}(r)}function s(e){this.def=e,this.triggered=!1}function c(e){this.promise=e,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function f(t){if("function"!=typeof t)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var i=new c(this);this.then=function(t,r){var a={success:"function"!=typeof t||t,failure:"function"==typeof r&&r};return a.promise=new this.constructor(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw TypeError("Not a function");a.resolve=e,a.reject=t}),i.chain.push(a),0!==i.state&&e(n,i),a.promise},this.catch=function(e){return this.then(void 0,e)};try{t.call(void 0,function(e){r.call(i,e)},function(e){o.call(i,e)})}catch(e){o.call(i,e)}}var l,h,d,m=Object.prototype.toString,p="undefined"!=typeof setImmediate?function(e){return setImmediate(e)}:setTimeout;try{Object.defineProperty({},"x",{}),l=function(e,t,n,i){return Object.defineProperty(e,t,{value:n,writable:!0,configurable:i!==!1})}}catch(e){l=function(e,t,n){return e[t]=n,e}}d=function(){function e(e,t){this.fn=e,this.self=t,this.next=void 0}var t,n,i;return{add:function(r,a){i=new e(r,a),n?n.next=i:t=i,n=i,i=void 0},drain:function(){var e=t;for(t=n=h=void 0;e;)e.fn.call(e.self),e=e.next}}}();var g=l({},"constructor",f,!1);return f.prototype=g,l(g,"__NPO__",0,!1),l(f,"resolve",function(e){var t=this;return e&&"object"==("undefined"==typeof e?"undefined":a(e))&&1===e.__NPO__?e:new t(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw TypeError("Not a function");t(e)})}),l(f,"reject",function(e){return new this(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw TypeError("Not a function");n(e)})}),l(f,"all",function(e){var t=this;return"[object Array]"!=m.call(e)?t.reject(TypeError("Not an array")):0===e.length?t.resolve([]):new t(function(n,i){if("function"!=typeof n||"function"!=typeof i)throw TypeError("Not a function");var r=e.length,a=Array(r),o=0;u(t,e,function(e,t){a[e]=t,++o===r&&n(a)},i)})}),l(f,"race",function(e){var t=this;return"[object Array]"!=m.call(e)?t.reject(TypeError("Not an array")):new t(function(n,i){if("function"!=typeof n||"function"!=typeof i)throw TypeError("Not a function");u(t,e,function(e,t){n(t)},i)})}),f})}).call(t,function(){return this}())},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={THRESHOLD_PERCENT:0,THRESHOLD_PIXELS:1}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),u=i(o),s=n(6),c=i(s),f=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,e),this.width=t,this.height=n,this._canvas=u.default.createCanvas(t,n),this._context=this._canvas.getContext("2d"),this._image=i,i?this._drawImage(this._image):this._imageData=this._context.createImageData(t,n)}return a(e,[{key:"setColorAt",value:function(e,t,n){var i=4*(t*this.width+e);this._imageData.data[i]=255*n.r|0,this._imageData.data[i+1]=255*n.g|0,this._imageData.data[i+2]=255*n.b|0,this._imageData.data[i+3]=255*n.a|0}},{key:"getColorAt",value:function(e,t){var n=4*(this.width*t+e),i=this._imageData.data[n]/255,r=this._imageData.data[n+1]/255,a=this._imageData.data[n+2]/255,o=this._imageData.data[n+3]/255;return new c.default(i,r,a,o)}},{key:"getImageData",value:function(){return this._imageData}},{key:"setImageData",value:function(e){this._imageData.data.set(e.data)}},{key:"clone",value:function(){var t=new e(this.width,this.height);return t.setImageData(this._imageData),t}},{key:"persist",value:function(){this._context.putImageData(this._imageData,0,0)}},{key:"toBuffer",value:function(){return this.persist(),this._canvas.toBuffer()}},{key:"_drawImage",value:function(e){this._context.drawImage(e,0,0),this._imageData=this._context.getImageData(0,0,this.width,this.height)}},{key:"canvas",get:function(){return this._canvas}},{key:"imageData",get:function(){return this._imageData}}],[{key:"fromBuffer",value:function(t){var n=u.default.createImage();return n.src=t,new e(n.width,n.height,n)}},{key:"fromImage",value:function(t){return new e(t.width,t.height,t)}}]),e}();t.default=f},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t,i,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n(this,e),this.r=t,this.g=i,this.b=r,this.a=a}return i(e,[{key:"clone",value:function(){return new e(this.r,this.g,this.b,this.a)}},{key:"equals",value:function(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}},{key:"toString",value:function(){return"Color("+this.r+", "+this.g+", "+this.b+", "+this.a+")"}}],[{key:"TRANSPARENT",get:function(){return new e(0,0,0,0)}},{key:"WHITE",get:function(){return new e(1,1,1,1)}},{key:"BLACK",get:function(){return new e(0,0,0,1)}},{key:"RED",get:function(){return new e(1,0,0,1)}}]),e}();t.default=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),u=i(o),s=n(3),c=i(s),f=n(4),l=i(f),h=n(5),d=i(h),m=n(6),p=i(m),g=n(8),v=i(g),_=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),this._imageA=t,this._imageB=n,this._prepareImages(),this._options=u.default.defaults(i,{maxDelta:.02,thresholdType:l.default.THRESHOLD_PERCENT,maxThreshold:.01,renderComposition:!1,compositionMaskColor:p.default.RED,maxOffset:0}),this._options.renderComposition&&(this._compositionImage=new v.default(this._imageA,this._imageB))}return a(e,[{key:"compare",value:function(){var e=this;return new c.default(function(t,n){var i=Math.min(e._imageA.width,e._imageB.width),r=Math.min(e._imageA.height,e._imageB.height),a=0,o=void 0,u=void 0;for(o=0;o<i;o++)for(u=0;u<r;u++){var s=e._comparePosition(o,u);s||(e._options.renderComposition&&e._compositionImage.setColorAt(o,u,e._options.compositionMaskColor),a++)}var c=a,f=i*r,h=a/f;e._options.thresholdType===l.default.THRESHOLD_PERCENT&&(c=h);var d=c<=e._options.maxThreshold;e._options.renderComposition?e._compositionImage.render().then(function(e){t({differences:a,percentageDifference:h,threshold:c,passed:d,compositionImage:e})}):t({differences:a,percentageDifference:h,threshold:c,passed:d})})}},{key:"_prepareImages",value:function(){var e=Math.max(this._imageA.width,this._imageB.width),t=Math.max(this._imageB.height,this._imageB.height);this._imageA=this._ensureImageDimensions(this._imageA,e,t),this._imageB=this._ensureImageDimensions(this._imageB,e,t)}},{key:"_ensureImageDimensions",value:function(e,t,n){if(e.width===t&&e.height===e.height)return e;e.persist();var i=new d.default(t,n,e.canvas);return i}},{key:"_calculateColorDelta",value:function(e,t){var n=0;return n+=Math.pow(e.r-t.r,2),n+=Math.pow(e.g-t.g,2),n+=Math.pow(e.b-t.b,2),n+=Math.pow(e.a-t.a,2)}},{key:"_comparePosition",value:function(e,t){var n=this._options,i=n.maxDelta,r=n.maxOffset,a=this._imageA.getColorAt(e,t),o=this._imageB.getColorAt(e,t),u=this._calculateColorDelta(a,o);if(u<i)return!0;if(0===r)return!1;var s=this._imageA,c=s.width,f=s.height,l=Math.max(0,e-r),h=Math.min(c-1,e+r),d=Math.max(0,t-r),m=Math.min(f-1,t+r),p=void 0,g=void 0;for(p=l;p<=h;p++)for(g=d;g<=m;g++)if(p!==e&&g!==t){var v=this._imageA.getColorAt(p,g),_=this._calculateColorDelta(a,v),y=this._imageB.getColorAt(p,g),b=this._calculateColorDelta(a,y);if(Math.abs(b-_)<i&&_>i)return!0}return!1}}]),e}();t.default=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(3),c=i(s),f=n(2),l=i(f),h=n(5),d=i(h),m=function(e){function t(e,n){r(this,t),e.persist(),n.persist();var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.width,e.height,e.canvas));return i._imageA=e,i._imageB=n,i}return o(t,e),u(t,[{key:"render",value:function(){var e=this;return new c.default(function(t,n){e._canvas.width=3*e._imageA.width,e._context.drawImage(e._imageA.canvas,0,0),e._context.drawImage(e._imageB.canvas,2*e._imageA.width,0),e._context.putImageData(e._imageData,e._imageA.width,0);var i=l.default.createImage();i.addEventListener("load",function(){t(i)}),i.src=e._canvas.toDataURL("image/png")})}}]),t}(d.default);t.default=m},function(e,t){"use strict";e.exports={name:"rembrandt",version:"0.1.3",description:"Client- and server-side image comparison library",main:"build/node.js",repository:{url:"git://github.com/imgly/rembrandt.git",type:"git"},scripts:{test:"node_modules/.bin/mocha --require test/support test/*.test.js",build:"node_modules/.bin/webpack"},author:"PhotoEditorSDK.com <contact@photoeditorsdk.com>",license:"MIT",dependencies:{canvas:"^2.0.0-alpha.6"},devDependencies:{"babel-core":"^6.17.0","babel-loader":"^6.2.5","babel-preset-es2015":"^6.16.0","babel-register":"^6.16.3",chai:"^3.5.0","chai-as-promised":"^6.0.0","json-loader":"^0.5.4",mocha:"^3.1.2","preprocess-loader":"^0.2.0",should:"^11.1.1","standard-loader":"^5.0.0",webpack:"^1.13.2"}}}])});